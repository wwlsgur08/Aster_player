<!DOCTYPE html>
<html>
<head>
    <title>ì‹¤ì‹œê°„ ë™ê¸°í™” í…ŒìŠ¤íŠ¸</title>
</head>
<body>
    <h1>Firebase ì‹¤ì‹œê°„ ë™ê¸°í™” í…ŒìŠ¤íŠ¸</h1>
    <div id="status">ì—°ê²° ì¤‘...</div>
    <div id="tracks"></div>
    
    <button id="addTest">í…ŒìŠ¤íŠ¸ ìŒì•… ì¶”ê°€</button>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
    
    <script>
        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyCauC5NvMol_9fX0i2q7wI8zht1xKdS2v4",
            authDomain: "aster-music-player.firebaseapp.com",
            databaseURL: "https://aster-music-player-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "aster-music-player",
            storageBucket: "aster-music-player.firebasestorage.app",
            messagingSenderId: "764474066780",
            appId: "1:764474066780:web:45430a3130f383aa8aa399"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        const statusDiv = document.getElementById('status');
        const tracksDiv = document.getElementById('tracks');
        
        // ì‹¤ì‹œê°„ êµ¬ë…
        database.ref('music-tracks').on('value', (snapshot) => {
            const data = snapshot.val();
            console.log('ğŸ”¥ Firebase ë°ì´í„° ìˆ˜ì‹ :', data);
            
            if (data) {
                const tracks = Object.entries(data).map(([id, track]) => ({ id, ...track }));
                tracks.sort((a, b) => b.createdAt - a.createdAt);
                
                tracksDiv.innerHTML = `
                    <h3>ìŒì•… ë¦¬ìŠ¤íŠ¸ (${tracks.length}ê°œ)</h3>
                    ${tracks.map(track => `
                        <div style="border: 1px solid #ccc; padding: 10px; margin: 5px;">
                            <strong>${track.title}</strong> - ${track.artist}<br>
                            ì‘ì„±ì: ${track.name}<br>
                            ìƒì„±ì‹œê°„: ${new Date(track.createdAt).toLocaleString()}<br>
                            ì†ŒìŠ¤: ${track.source}
                        </div>
                    `).join('')}
                `;
                
                statusDiv.textContent = `âœ… ì—°ê²°ë¨ - ${tracks.length}ê°œ ìŒì•…`;
            } else {
                tracksDiv.innerHTML = '<p>ìŒì•…ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                statusDiv.textContent = 'âœ… ì—°ê²°ë¨ - ë°ì´í„° ì—†ìŒ';
            }
        });
        
        // í…ŒìŠ¤íŠ¸ ìŒì•… ì¶”ê°€
        document.getElementById('addTest').addEventListener('click', () => {
            const testTrack = {
                name: 'í…ŒìŠ¤íŠ¸ìœ ì €',
                title: 'í…ŒìŠ¤íŠ¸ ìŒì•…',
                artist: 'Aster AI',
                duration: 60,
                audioUrl: 'data:audio/wav;base64,test',
                charmTraits: [
                    { charm_name: 'ë‹¤ì •í•¨', stage: 8 },
                    { charm_name: 'ìœ ë¨¸ê°ê°', stage: 6 }
                ],
                createdAt: Date.now(),
                source: 'test'
            };
            
            database.ref('music-tracks').push(testTrack)
                .then(() => {
                    console.log('âœ… í…ŒìŠ¤íŠ¸ ìŒì•… ì¶”ê°€ ì™„ë£Œ');
                })
                .catch((error) => {
                    console.error('âŒ í…ŒìŠ¤íŠ¸ ìŒì•… ì¶”ê°€ ì‹¤íŒ¨:', error);
                });
        });
        
        // ì—°ê²° ìƒíƒœ í™•ì¸
        database.ref('.info/connected').on('value', (snapshot) => {
            if (snapshot.val() === true) {
                console.log('ğŸ”¥ Firebase ì—°ê²°ë¨');
            } else {
                console.log('âŒ Firebase ì—°ê²° ëŠì–´ì§');
                statusDiv.textContent = 'âŒ Firebase ì—°ê²° ëŠì–´ì§';
            }
        });
    </script>
</body>
</html>